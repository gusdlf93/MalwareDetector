import numpy as np
import os
import pandas as pd
root = r'D:\android\Data\data_sec_20_txt\conv1d_4_grad'
label = os.listdir(root)

for l in label:
    label_folder_path = os.path.join(root, l)
    npy_list = os.listdir(label_folder_path)
    for n in npy_list:
        data = os.path.join(label_folder_path,n)
        if not os.path.isdir(os.path.join(r'D:\android\Data\data_sec_20_txt\conv1d_4_grad_sec', l)):
            os.makedirs(os.path.join(r'D:\android\Data\data_sec_20_txt\conv1d_4_grad_sec', l))
        dest_path = os.path.join(r'D:\android\Data\data_sec_20_txt\conv1d_4_grad_sec', l, n.replace('.npy', '.csv'))

        arr = np.load(data, allow_pickle=True)
        zero_list = []
        for i in range(len(arr)):
            if len(arr[i]) == 0:
                zero_list.append(i)
        zero_list = [zero_list[::-1]]

        for i in range(len(zero_list)):
            arr = np.delete(arr, zero_list[i])
        arr_list = []
        for i in range(len(arr)):
            arr_list.append(np.asarray(arr[i]))
        try:
            #하나인 경우
            if len(arr[0]):
                dataframe = pd.DataFrame(arr_list)
                dataframe.to_csv(dest_path, header = False, index = False)
                #np.savetxt(dest_path, arr_list, delimiter=" ", fmt='%.18e')
        except TypeError:
            #여러개인 경우 typeerror가 뜰겁니다. 초기 저장을 잘못해서 그렇습니다.
            arr_list = np.array(arr_list).reshape(1, len(arr_list))
            dataframe = pd.DataFrame(arr_list)
            dataframe.to_csv(dest_path, header=False, index=False)
            #np.savetxt(dest_path, arr_list, delimiter=" ", fmt='%.18e')
        except IndexError:
            print("No")
            continue
